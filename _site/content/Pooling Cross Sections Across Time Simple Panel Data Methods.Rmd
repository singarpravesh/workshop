---
title: "Introductory<br>Econometrics (Practical)"
subtitle: "Chapter 13: Pooling Cross Sections Across Time: Simple Panel Data Methods"
author: "Wooldridge"
date: "Even Sem - 2020"
output: 
  ioslides_presentation:
    smaller: true
---


```{css, echo=FALSE}
pre {
  max-height: 400px;
  overflow-y: auto;
}

pre[class] {
  max-height: 100px;
}
```

# Pooling Independent Cross Sections across Time

---

- One reason for using independently pooled cross sections is to increase the sample size. 
- By pooling random samples drawn from the same population, but at different points in time, we can get more precise estimators and test statistics with more power.
- To reflect the fact that the population may have different distributions in different time periods, we allow the intercept to differ across periods, usually years. 
- This is easily accomplished by including dummy variables for all but one year, where the earliest year in the sample is usually chosen as the base year.

---

**Example 13.1: Womeen's fertility over time**

- Dataset: `fertil1.csv`, package: `wooldridge`
- Check `fertil1.txt` for variables description.
- Question: <u>After controlling for other observable factors, what has happened to fertility rates over time?</u>
- The factors we control for are years of education, age, race, region of the country where living at age 16, and living environment at age 16.

```{r, warning=FALSE, message=FALSE}
# read the data
library(wooldridge)
data(fertil1)
table(fertil1$year)
```


---

Example 13.1
```{r}
# regression
lm_fertil1 <- lm(kids ~ educ + age + I(age^2) + as.factor(black) + as.factor(east) + 
                   as.factor(northcen) + as.factor(west) + as.factor(farm) 
+ as.factor(othrural) + as.factor(town) + as.factor(smcity) +as.factor(year), 
data = fertil1)
# "clustered' se
stargazer::stargazer(lm_fertil1,
se =list( sqrt(diag(sandwich::vcovHC(lm_fertil1, type = "HC1")))),
                      type = "text")
```

---

Example 13.1

- The base year is 1972. The coefficients on the year dummy variables show a sharp drop in fertility in the early 1980s. For example, the coefficient on $y82$ implies that, holding education, age, and other factors fixed, a woman had on average 0.52 less children, or aboutone-half a child, in 1982 than in 1972. This is a very large drop: holding educ, age, and the other factors fixed, 100 women in 1982 are predicted to have about 52 fewer children than 100 comparable women in 1972. 
- Since we are controlling for education, this drop is separate from the decline in fertility that is due to the increase in average education levels. (The average years of education are 12.2 for 1972 and 13.3 for 1984.) 
- Women with more education have fewer children, and the estimate is very statistically significant.
- Age has a diminishing effect on fertility. (The turning point in the quadratic is at about $age = 46$, by which time most women have finished having children.)

---

**Example 13.2: Changes in the return to education and the gender wage gap**

- The model we shall estimate:
$$
{\small\begin{align}
log(wage) &= \beta_0 + \beta_1y85+ \beta_2educ + \beta_3y85\cdot educ + \beta_4exper \\&+ \beta_5exper^2 + \beta_6union + \beta_7female + \beta_8y85\cdot female + u
\end{align}}
$$
- Dataset: `cps78_85.csv`
- There are 550 people in the sample in 1978 and a different set of 534 people in 1985.
- Objective: <u>Examine how the return to education and the gender gap have changed from 1978 to 1985. </u>

---

Example 13.2

```{r}
data("cps78_85")
str(cps78_85)
```

---

Example 13.2

```{r, message=FALSE, warning=FALSE}
library(sandwich); library(lmtest); library(stargazer)
# the model
e13.2PooledModel <- lm(lwage ~ as.factor(y85) + educ + as.factor(y85)*educ + 
exper + I(exper^2) + as.factor(union) + as.factor(female) +
  as.factor(y85)*as.factor(female), data = cps78_85) 

stargazer(e13.2PooledModel, type = "text", 
se = list(sqrt(diag(vcovHC(e13.2PooledModel, type = "HC1")))))
```




---

Example 13.2

Observations:

- The return to education in 1978 is estimated to be about 7.5%; the return to education in 1985 is about 1.85 percentage points higher, or about 9.35%. 
- Because the t statistic on the interaction term is .0185/.0094  $\approx$ 1.97, the difference in the return to education is statistically significant at the 5% level against a two-sided alternative.
- What about the gender gap? In 1978, other things being equal, a woman earned about 31.7% less than a man (27.2% is the more accurate estimate). 
- In 1985, the gap in log(wage) is 2.317 - .085 = 2.232. Therefore, the gender gap appears to have fallen from 1978 to 1985 by about 8.5 percentage points. The t statistic on the interaction term is about 1.67, which means it is significant at the 5% level against the positive one-sided alternative.

---

**Example 13.3: Effect of a garbage incinerator's location on housing prices**

- The story:

*Kiel and McClain (1995) studied the effect that a new garbage incinerator had on housing values in North Andover, Massachusetts. They used many years of data and a fairly complicated econometric analysis. We will use two years of data and some simplified models, but our analysis is similar.*

*The rumor that a new incinerator would be built in North Andover began after 1978, and construction began in 1981. The incinerator was expected to be in operation soon after the start of construction; the incinerator actually began operating in 1985.*

*We will use data on prices of houses that sold in 1978 and another sample on those that sold in 1981.* 

*The hypothesis is that the price of houses located near the incinerator would fall relative to the price of more distant houses.*

---

Example 13.3

- Estimate separate models for 1978 (before there were rumors about the new incinerator) and 1981 (when the construction began).
```{r}
# load the data
data("kielmc")
```

- The model we are estimating is
$$
{\small\text{ For Year = 1978 and 1981 separately}\\
rprice = \beta_0 + \beta_1nearinc +u 
}
$$

---

Example 13.3

```{r}
# year = 1978
model_y78 <- lm(rprice ~ nearinc, data = kielmc, subset = (year == 1978))

# year = 1981
model_y81 <- lm(rprice ~ nearinc, data = kielmc, subset = (year == 1981))

stargazer(model_y78, model_y81,
se = list(
sqrt(diag(vcovHC(model_y78, type = "HC1"))),
sqrt(diag(vcovHC(model_y81, type = "HC1")))),
type = "text", out = "summary_model78_81.txt",
column.labels = c("modely78", "modely81"))
```


---

Example 13.3

- In 1981, the houses close to the construction site were cheaper by an average of $30,688.27.
- In 1978 too houses near the construction site were cheaper by an average of $18,824.
- Therefore, we cannot conclude that the construction of incinerator is causing the lower housing values. We may conclude that the incinerator was built in an area with lower housing values.
- How can we tell whether building new incinerator depresses housing values?
    - We can check how the coefficient on $nearinc$ changed between 1978 and 1981.
    - We estimate the following model;
    $$
    rprice = \beta_0 + \delta_0y81 + \beta_1nearinc + \delta_1y81\cdot nearinc + u
    $$

where, $\beta_0$ is the average price of a home not near the incinerator in 1978. <br>
$\delta_0$ captures the changes in all housing values from 1978 to 1981. <br>
$\delta_1$ **(known as the difference-in-differences)** measures the decline in housing values due to the new incinerator.

---

Example 13.3

```{r, message=FALSE, warning=FALSE}
library(stargazer); library(sandwich); library(lmtest)
e13.3PooledModel1 <- lm(rprice ~ y81 + nearinc + y81*nearinc, data = kielmc)
e13.3PooledModel2 <- lm(rprice ~ y81 + nearinc + y81*nearinc + age + I(age^2), data = kielmc)
e13.3PooledModel3 <- lm(rprice ~ y81 + nearinc + y81*nearinc + age + I(age^2) + intst 
           + land +  area + rooms + baths, data = kielmc)

stargazer(e13.3PooledModel1, e13.3PooledModel2, e13.3PooledModel3,
se = list(sqrt(diag(vcovHC(e13.3PooledModel1, type = "HC1"))),
sqrt(diag(vcovHC(e13.3PooledModel2, type = "HC1"))),
sqrt(diag(vcovHC(e13.3PooledModel3, type = "HC1")))),
digits = 3, type = "text")
```



---

<u> Difference-in-differences estimator</u>

**Example 13.4: Effect of worker compensation laws on weeks out of work**

- Meyer, Viscusi, and Durbin (1995) (hereafter, MVD) studied the length of time (in weeks) that an injured worker receives workers’ compensation. 
- On July 15, 1980, Kentucky raised the cap on weekly earnings that were covered by workers’ compensation.
- An increase in the cap has no effect on the benefit for low-income workers, but it makes it less costly for a high-income worker to stay on workers’ compensation. 
- Therefore, the control group is low-income workers, and the treatment group is high-income workers; high-income workers are defined as those who were subject to the pre-policy change
cap. 
- Using random samples both before and after the policy change, MVD were able to test whether more generous workers’ compensation causes people to stay out of work longer (everything else fixed). They started with a difference-in-differences analysis, using `log(durat)` as the dependent variable. Let `afchnge` be the dummy variable for observations after the policy change and `highearn` the dummy variable for high earners.
- The dataset is `injury.csv`.

---

Example 13.4

- We estimate the following model
$$
log(durat) = \beta_0 + \delta_0afchnge + \beta_1highearn +\delta_1afchange\cdot highearn + u
$$


```{r}

# the model
data(injury)
e13.4PooledModel <-lm(log(durat) ~ afchnge + highearn + afchnge*highearn, data = injury )
coeftest(e13.4PooledModel, vcov. = vcovHC(e13.4PooledModel, type = "HC1"))
```

- The average length of time on workers’ compensation for high earners increased by about 19% due to the increased earnings
cap. 



# Two-period panel data analysis

---

- Consider the model
$$
y_{it} = \beta_0 + \beta_1x_{it1}+ \dots + \beta_kx_{itk}+a_i+u_{it} \\
t = 1, \dots, T; i = 1, \dots, n
$$

where, $a_i$ is an unobserved factor and constant over time.<br>
If $a_i$ is correlated with one or more of $x_{it1}, x_{it2},\dots , x_{itk}$, the OLS estimates are biased and inconsistent.

- The **first difference (FD) estimator** is based on the first difference of the whole equation:
$$
\Delta{y_{it}} = \beta_1\Delta{x_{it1}}+ \dots + \beta_k\Delta{x_{itk}}+\Delta{u_{it}} \\
t = 2, \dots, T; i = 1, \dots, n
$$
Note that we cannot evaluate this equation for $t=1$ for any $i$ since the lagged values are unknown for them.

- The trick is that $a_i$ drops out of the equation by differencing since it does not change over time. No matter how badly it is correlated with the regressors, it cannot hurt the estimation anymore. 

---

- Dataset: `crime2.csv`
- A simple first differenced model for city crime rates for 1982 and 1987
$$
crmrte_{it} = \beta_0 + \beta_1unem_{it} + a_i+u_{it}
$$

```{r, message=FALSE, warning=FALSE}
# model
data(crime2)
library(plm)
summary(plm(crmrte ~ unem ,index = c("area"), data = crime2,model = "fd"))
# or if you have a balanced panel, use
# summary(plm(crmrte ~ unem ,index = nrow(crime2)/2, data = crime2,model = "fd"))
```



---

**Example 13.5: Sleeping versus working**

- We use the two years of panel data in SLP75_81.RAW, from Biddle and Hamermesh (1990), to estimate the tradeoff between sleeping and working. 
- The panel data set for 1975 and 1981 has 239 people, which is much smaller than the 1975 cross section that includes over 700 people.
- Dataset: `slp75_81`


---

Example 13.5

- We are tyring to estimate the tradeoff between sleeping and working.
- Note that the variables `cslpnap`, `ctotwork`, `ceduk`, `cmarr`, `cyngkid`, `cgdhlth` are the differences of values for the two years 1981 and 1975. Use `?slp75_81` to check the description.

```{r}
data("slp75_81")
lm(cslpnap ~ ctotwrk + ceduc + cmarr + cyngkid + cgdhlth, data = slp75_81)
```


---

**Example 13.9: County crime rates in North Carolina**

- Dataset: `crime4`
- Objective: To estimate an unobserved effects model of crime.
- Model: 
```{r}
data("crime4")
coeftest(plm(lcrmrte ~ d83 + d84 + d85 + d86 + d87 + lprbarr+ lprbconv + lprbpris + lavgsen+ 
               lpolpc, data = crime4, index = "county", model = "fd"), vcov. = vcovHC)
```





